---
title: "Module 1: Climate change"
format: pdf
editor: visual
---

```{r}
#| warning: false
#| output-location: false
library(tidyverse)
```

## Team members, etc

List your team member(s): Ana Rowley

Include a link to your forked GH repository:

Include a link to your .qmd file:

## CO2 trends from Mauna Loa

We will begin at the global scale by plotting the famed Mauna Loa CO~2~ curve at monthly intervals, with the twin objectives of (1) making layered plots with 'ggplot2', a package within the 'tidyverse' collection widely adopted by the R data science community, and (2) refreshing understanding of the seasonal cycle in atmospheric \[CO~2~\].

With data you've collected yourself, it is more common to store locally as a csv. However, we can use tidyverse tools to read directly from files stored online and will do so here to get the latest data.

```{r}
#| warning: false
#| output: false
co2 <-read_table("https://gml.noaa.gov/webdata/ccgg/trends/co2/co2_mm_mlo.txt", 
                  comment="#",
                  col_names = c("year", "month", "decimal_date", "average",
                                "interpolated", "trend", "days"),
                  na = c("-1", "-99.99"))
```

You can examine these data in several ways. One option is to use your mouse in the Environment tab and click on the dataset name. Alternatively, you can type `View(co2)` in your console to achieve the same outcome. Below are some other common options to understand the data structure at a glance.

```{r}
str(co2)
head(co2)
```

### Q1 (1 point)

Create a timeseries plot of average \[CO~2~\]. Use `as.Date()` to create a formatted date for the x-axis. Label both the y-axis and add a line to connect the points.

```{r}
#library 
library(ggplot2)

# create a date from year + month (set day = 1)
co2$date <- as.Date(paste(co2$year, 
                          co2$month, "1", 
                          sep = "-"), format = "%Y-%m-%d") #using as.Date()
head(co2)

# make the timeseries plot
ggplot(co2, aes(x = date, 
                y = average)) +
  geom_line() +
  labs(x = "Date", 
       y = "Average CO2 (ppm)") +
  scale_x_date(date_labels = "%b %Y", #specifies formate "Mon Year"
               date_breaks = "5 years") + #specifies the count of the x-axis
  theme_classic() +
  theme(
    axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)
  )

```

### Q2 (1 point)

What months are the \[CO~2~\] values at the maximum? Create another dataframe with these months selected and create a plot like above, but with the maximum months colored in "forestgreen".

```{r}
# find mean CO2 for each month across all years
monthly_mean <- co2 %>%
  group_by(month) %>%
  summarise(mean_CO2 = mean(average, 
                            na.rm = TRUE)) %>%
  ungroup()
monthly_mean

# find months with the max CO2 avg
max_months <- monthly_mean %>%
  filter(mean_CO2 == max(mean_CO2))
max_months

# create new data set with only max months
c02_max_months <- co2 %>%
  filter(month %in% max_months$month)
View(c02_max_months)

# plot max months using new dataset
ggplot(c02_max_months, aes(x = date, 
                           y = average)) +
  geom_line() +
  geom_point(color = "forestgreen", 
             size = 1) + #makes points "forestgreen"
  labs(x = "Date", y = "Average CO2 (ppm)") +
  scale_x_date(date_labels = "%b %Y",
               date_breaks = "5 years") +  
  theme_classic(base_size = 14) +
  theme(
    axis.text.x = element_text(angle = 45, 
                               vjust = 1, hjust = 1))

```

### Q3 (1 point)

What explains the seasonal variation in \[CO~2~\]? After reading Lewandowsky et al. 2016, how might you go about separating the long term trend and the seasonal variation in \[CO~2~\]?

After reading Lewandowsky et al. 2016, I would create a plot grouped by year to show monthly variation in average CO2 by year. Then, I think showing the plot from Q1 is beneficial because it shows both the general seasonal variation while highlighting the overall upwards trend.

## Global temperature

Next, we turn to a global temperature anomaly dataset from NASA GISS, similar to the GMST used by Lewandowsky et al. 2016.

### Q4 (1 point)

Read some [background](https://data.giss.nasa.gov/gistemp/history/background.html) as well as the [simplified documentation](https://climate.nasa.gov/vital-signs/global-temperature/?intent=121) for this dataset.

How are the measurements made? Describe each column in the dataset and its units. What are the resolution of the data?

The measurements 

Year - The calendar year for each record. Each year corresponds to the global temperature anomaly data.

No_Smoothing - The annual global surface temperature anomaly, in hundredths of degrees Celsius, relative to the NASA-GISS baseline period 1951–1980.

Lowess(5) - a smoothed version of the annual anomaly, using a 5-year LOWESS (locally weighted scatterplot smoothing) to filter out short-term variability (e.g. El Niño/La Niña) and highlight long-term trends. The units are the same as No_Smoothing: hundredths of degrees Celsius relative to the 1951–1980 baseline.

### Q5 (1 point)

Construct code to import dataset in a format that can be used for transforming and visualization.

```{r}
#| warning: false
#| output: false
library(readr)

temp_index <- read_table(
  "https://data.giss.nasa.gov/gistemp/graphs/graph_data/Global_Mean_Estimates_based_on_Land_and_Ocean_Data/graph.txt",
  comment = "#",
  col_names = c("Year", "No_Smoothing", "Lowess(5)"),
  col_types = cols(
    Year = col_integer(),
    No_Smoothing = col_double(),
    `Lowess(5)` = col_double()
  )
)

temp_index <- temp_index |> 
  drop_na()

View(temp_index)
```

### Q6 (1 point)

Plot the trend in global mean temperature over time. Describe what you see and how you interpret the patterns you observe.

```{r}
ggplot(temp_index, aes(x = Year, y = No_Smoothing)) +
  geom_line(color = "grey",
            fill = "white") +
  geom_point(color = "grey", size = 2) +
  labs(x = "Year", y = "Temperature Anomaly (°C)") +
  scale_x_continuous(breaks = seq(1880, 2020, 20)) +
  theme_bw(base_size = 14)
```

The global mean temperature overtime plot shows an expected trend of yearly fluctuations around the annual global surface temperature anomally. However, there is an overall upwards trend. This suggests that the annual global surface temperature anomaly is increasing -> the Earth is warming. 


### Q7 (1 point)

Consider the "pause" analyzed in Lewandowsky et al. 2016. Do you see evidence for such a pause?

If you only look at the raw annual values on the plot, you might think there is a “pause” around 1880–1960. But, as we can see with the smoothed data or using statistical analysis as performed by Lewandowsky et al., there is no real pause. It is just short-term variability within a strong long-term warming trend.

### Bonus 1 (1 point)

Recreate the analysis from Lewandowsky's Fig. 1.

## Long term records of CO2

The data from Mauna Loa go back as far as modern instrumentation. To put these values into geological perspective, we must go back much further than humans have been monitoring \[CO~2~\]. Ice sheets contain layers of snow with trapped air bubbles and can be cored and dated like tree rings.

Previously hosted by Oak Ridge National Lab, the [data](https://zenodo.org/records/3678928) associated with the famed Vostok Ice Core is now archived on Zenodo. Skim [Barnola et al. 1987](https://www.nature.com/articles/329408a0) as needed.

After downloading this dataset, create a folder entitled `data` and save the file within the folder with a .txt extension. Read this file into R, making sure you understand the column names and units.

### Q8 (1 point)

After downloading this dataset, create a folder entitled `data` and save the file within the folder with a .txt extension. Read this file into R. What are the columns and units? How were these data obtained?

### Q9 (1 point)

Transform the data as needed to create a plot in chronological order. Add at least two different smoothing window averages to your plot.

### Q10 (1 point)

Join your data with the Mauna Loa data and plot together, considering different colors for the different datasets.

### Bonus 2 (1 point)

Write a catchy title and short description in the style of a NYtimes infographic, contrasting the rate of anthropogenic vs. background climate change for a general public audience.

cd CLES131
pwd
git clone git@github.com:arowley04/CLES131-module1-climate.git
git status
git add module1.qmd
git commit -m "Finished Q4-7" 
git push